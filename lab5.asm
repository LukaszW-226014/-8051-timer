LJMP START
P5 equ 0F8H
P7 equ 0DBH
P6 EQU 0FAH

; LCD registers ----------------------------------
LCDstatus equ 0FF2EH
LCDcontrol equ 0FF2CH
LCDdataWR equ 0FF2DH
LCDdataRD equ 0FF2FH

// LCD control bytes ----------------------------------
#define HOME 0x80 // put curcor to first line
#define INITDISP 0x38 // LCD init (8-bit mode)
#define HOM2 0xc0 // put curcor to second line
#define LCDON 0x0e // LCD nn, cursor off, blinking off
#define CLEAR 0x01 // LCD display clear
ORG 000BH
MOV TH0,#00H
MOV TL0,#00H
DEC R0
RETI

ORG 0100H

LCDcntrlWR MACRO x
LOCAL loop
loop:
MOV DPTR,#LCDstatus
MOVX A,@DPTR
JB ACC.7,loop ; check if LCD busy

MOV DPTR,#LCDcontrol ; write to LCD control
MOV A, x
MOVX @DPTR,A
ENDM

LCDcharWR MACRO
LOCAL loop1,loop2

PUSH ACC
loop1: MOV DPTR,#LCDstatus
MOVX A,@DPTR
JB ACC.7,loop1 ; check if LCD busy

loop2: MOV DPTR,#LCDdataWR ; write data to LCD
POP ACC
MOVX @DPTR,A
ENDM

init_LCD MACRO
LCDcntrlWR #INITDISP
LCDcntrlWR #CLEAR
LCDcntrlWR #LCDON
ENDM


START:
init_LCD

MOV R7,#10H
START1:
MOV DPH,#80H
MOV DPL,#01110111B
MOV A,#01H
;CPL A
MOVX @DPTR,A
MOV DPL,#01111011B
MOV A,#02H
;CPL A
MOVX @DPTR,A
MOV DPL,#01111101B
MOV A,#03H
;CPL A
MOVX @DPTR,A
MOV DPL,#01111110B
MOV A,#0AH
;CPL A
MOVX @DPTR,A
MOV DPL,#10110111B
MOV A,#04H
;CPL A
MOVX @DPTR,A
MOV DPL,#10111011B
MOV A,#05H
;CPL A
MOVX @DPTR,A
MOV DPL,#10111101B
MOV A,#6H
;CPL A
MOVX @DPTR,A
MOV DPL,#10111110B
MOV A,#0BH
;CPL A
MOVX @DPTR,A
MOV DPL,#11010111B
MOV A,#07H
;CPL A
MOVX @DPTR,A
MOV DPL,#11011011B
MOV A,#08H
;CPL A
MOVX @DPTR,A
MOV DPL,#11011101B
MOV A,#09H
;CPL A
MOVX @DPTR,A
MOV DPL,#11011110B
MOV A,#0CH
;CPL A
MOVX @DPTR,A
MOV DPL,#11100111B
MOV A,#0EH
;CPL A
MOVX @DPTR,A
MOV DPL,#11101011B
MOV A,#00H
;CPL A
MOVX @DPTR,A
MOV DPL,#11101101B
MOV A,#0FH
;CPL A
MOVX @DPTR,A
MOV DPL,#11101110B
MOV A,#0DH
;CPL A
MOVX @DPTR,A

MOV TMOD,#01H
MOV TH0,#00H
MOV TL0,#00H
SETB TR0
MOV IE,#82H
MOV R7,#7FH
LICZNIK1:





W1:
MOV R0,#7FH

MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W2
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU3:MOV R5,#0FFH
TAM3:DJNZ R5,TAM3
DJNZ R4,TU3
;LCDcharWR
MOV R3,A
JMP L
W2:
MOV R0,#0BFH
MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W3
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU4:MOV R5,#0FFH
TAM4:DJNZ R5,TAM4
DJNZ R4,TU4
;LCDcharWR
 MOV R3,A
 JMP L
W3:
MOV R0,#0DFH
MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W4
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU5:MOV R5,#0FFH
TAM5:DJNZ R5,TAM5
DJNZ R4,TU5
MOV R3,A
JMP L
W4:
MOV R0,#0EFH
MOV A,R0
MOV P5,A
MOV A,P7
ANL A,R0
MOV R2,A
CLR C
SUBB A,R0
JZ W12
MOV A,R2
MOV DPH,#80H
MOV DPL,A
MOVX A,@DPTR
MOV P1,A
MOV R4,#0FFH
TU6:MOV R5,#0FFH
TAM6:DJNZ R5,TAM6
DJNZ R4,TU6
JMP c1




W12: JMP W1
c1:
;LCDcharWR

;DJNZ R7,START12
JMP C2
START12:
JMP START1
C2:
JZ W12

 MOV A,R3
 MOV B,#0AH
 ;SUBB A,#0AH
 DIV AB
 MOV R3,B
;LCDcntrlWR #HOM2
L: MOV R5,#31H
MOV R2,#30H

MOV R6,#09H
DALEJ:
MOV R0,#0FH

CZEKAM:
MOV A,R0
JNZ CZEKAM
MOV P1,R7
MOV A,R7
RR A
MOV R7,A

MOV A,P6
ORL A,#01000001B
MOV P6,A
;CPL P3.2
MOV R4,#0FFH
TU:MOV R1,#0FFH
TAM:DJNZ R1,TAM
DJNZ R4,TU
MOV A,P6
ANL A,#10111110B
MOV P6,A
;CPL P3.2
MOV R4,#0FFH
TU2:MOV R1,0FFH
TAM2:DJNZ R1,TAM2
DJNZ R4,TU2

LCDcntrlWR #CLEAR
MOV A,R2
LCDcharWR
MOV A,R5
INC R5
LCDcharWR
 
DJNZ R6,DALEJ
INC R2
MOV R5,#30H
DJNZ R3,DALEJ
;LCDcntrlWR #CLEAR
/* 
MOV R3,A
SUBB A, #10H
MOV R6, A
DALEJ2:
MOV R5,#31H
MOV R0,#0FH

CZEKAM2:
MOV A,R0
JNZ CZEKAM
MOV P1,R7
MOV A,R7
RR A
MOV R7,A

MOV A,P6
ORL A,#01000001B
MOV P6,A
;CPL P3.2
MOV R4,#0FFH
TU12:MOV R1,#0FFH
TAM12:DJNZ R1,TAM12
DJNZ R4,TU12
MOV A,P6
ANL A,#10111110B
MOV P6,A
;CPL P3.2
MOV R4,#0FFH
TU22:MOV R1,0FFH
TAM22:DJNZ R1,TAM22
DJNZ R4,TU22

LCDcntrlWR #CLEAR
MOV A,#31H
  LCDcharWR
MOV A,R5
INC R5
LCDcharWR
 
DJNZ R6,DALEJ2	*/


JMP L
JMP DALEJ
/*
MOV A,#41H
LCDcharWR
MOV A,#6CH
LCDcharWR
MOV A,#61H
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#6DH
LCDcharWR
MOV A,#61H
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#31H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#24H
LCDcharWR
MOV A,#2CH
LCDcharWR
LCDcntrlWR #HOM2
MOV A,#61H
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#4AH
LCDcharWR
MOV A,#61H
LCDcharWR
MOV A,#6EH
LCDcharWR
MOV A,#20H
LCDcharWR
MOV A,#33H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#30H
LCDcharWR
MOV A,#24H
LCDcharWR 

MOV DPTR,#8001H
MOV A,#6BH
MOVX @DPTR,A
INC DPTR
MOV A,#61H
MOVX @DPTR,A
INC DPTR
MOV A,#6EH
MOVX @DPTR,A
INC DPTR
MOV A,#61H
MOVX @DPTR,A
INC DPTR
MOV A,#72H
MOVX @DPTR,A
INC DPTR
MOV A,#32H
MOVX @DPTR,A
INC DPTR
MOV A,#33H
MOVX @DPTR,A
INC DPTR

MOV A,#57H
MOVX @DPTR,A
INC DPTR
MOV A,#69H
MOVX @DPTR,A
INC DPTR
MOV A,#74H
MOVX @DPTR,A
INC DPTR
MOV A,#61H
MOVX @DPTR,A
INC DPTR
L2:
init_LCD

MOV R1,#7H
MOV DPTR,#8001H
MOV R0,#01H
LOOP:
MOV DPH,#80H
MOV A,R0
MOV DPL,A
MOVX A,@DPTR
LCDcharWR
MOV R2,#0FFH
TU:MOV R3,#0FFH
TAM:DJNZ R3,TAM
DJNZ R2,TU
INC R0
DJNZ R1,LOOP	  

LCDcntrlWR #HOM2

MOV R1,#4H
MOV DPTR,#8008H
MOV R0,#08H
LOOP2:
MOV DPH,#80H
MOV A,R0
MOV DPL,A
MOVX A,@DPTR
LCDcharWR
MOV R2,#0FFH
TU2:MOV R3,#0FFH
TAM2:DJNZ R3,TAM2
DJNZ R2,TU2
INC R0
DJNZ R1,LOOP2
MOV R4,#0FFH
TU3:MOV R5,#0FFH
TAM3:DJNZ R5,TAM3
DJNZ R4,TU3
JMP L2	 */

NOP
NOP
NOP
JMP $
END START


 